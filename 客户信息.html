<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>客户信息</title>
<style>
    body{font-family:"微软雅黑";background:#f5f5f5;margin:0;padding:20px}
    .box{width:800px;margin:0 auto;background:#fff;padding:20px;border:1px solid #ddd}
    h2{margin:0 0 10px;font-size:18px}
    .row{margin-bottom:8px;font-size:14px}
    .row label{display:inline-block;width:80px;text-align:right;margin-right:6px}
    .row input,.row select{padding:5px;border:1px solid #ccc;width:180px}
    table{width:100%;border-collapse:collapse;font-size:14px;margin-top:10px}
    th,td{border:1px solid #ddd;padding:6px;text-align:center}
    th{background:#f0f0f0}
    .btn-add{padding:4px 10px;background:#2c7eda;color:#fff;border:none;cursor:pointer;font-size:12px}
    .btn-save{padding:6px 20px;background:#5cb85c;color:#fff;border:none;cursor:pointer;margin-top:10px}
    .short{width:60px}
    .table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
</style>
</head>
<body>
<div class="box">
    <h2>客户信息</h2>
    <form id="customerForm" onsubmit="return saveCustomer()">
        <div class="row">
            <label>客户姓名：</label>
            <input type="text" id="customerName" required>
            <label>性别：</label>
            <select id="gender">
                <option>男</option>
                <option>女</option>
            </select>
        </div>
        <div class="row">
            <label>联系电话：</label>
            <input type="text" id="phone" required>
            <label>微信：</label>
            <input type="text" id="wechat">
        </div>
        <div class="row">
            <label>地址：</label>
            <input type="text" id="address" style="width:400px">
        </div>

        <!-- 购买记录 -->
        <div class="table-header">
            <div></div>
            <button type="button" class="btn-add" onclick="addRecord()">添加购买记录</button>
        </div>
        <table id="recordTable">
            <thead>
                <tr><th>日期</th><th>商品名称</th><th>数量</th><th>金额(元)</th><th>操作</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <button type="submit" class="btn-save">保存客户信息</button>
    </form>
</div>

<script>
// 初始日期
document.getElementById("orderDate").value = new Date().toISOString().slice(0,10);
document.getElementById("orderNo").value = "SO-" + Date.now().toString().slice(-6);

// 添加购买记录行
function addRecord(){
    var tbody = document.querySelector("#recordTable tbody");
    var row = document.createElement("tr");
    row.innerHTML = 
        '<td><input type="date" class="short" required></td>'+
        '<td><input type="text" name="product" required></td>'+
        '<td><input type="number" min="1" name="qty" class="short" required></td>'+
        '<td><input type="number" step="0.01" min="0" name="amount" class="short" required></td>'+
        '<td><button type="button" class="btn-del" onclick="delRow(this)">删除</button></td>';
    tbody.appendChild(row);
}

// 删除行
function delRow(btn){
    btn.parentNode.parentNode.remove();
}

// 保存客户信息
function saveCustomer(){
    var name = document.getElementById("customerName").value;
    var gender = document.getElementById("gender").value;
    var phone = document.getElementById("phone").value;
    var wechat = document.getElementById("wechat").value;
    var address = document.getElementById("address").value;

    if(!name||!phone){alert("姓名和电话为必填项！");return false;}

    var records = [];
    var rows = document.querySelectorAll("#recordTable tbody tr");
    for(var i=0;i<rows.length;i++){
        var cells = rows[i].querySelectorAll("input");
        if(!cells[0].value||!cells[1].value||!cells[2].value||!cells[3].value){alert("购买记录请填写完整");return false;}
        records.push({
            date: cells[0].value,
            product: cells[1].value,
            qty: cells[2].value,
            amount: cells[3].value
        });
    }

    var customer = {
        name: name,
        gender: gender,
        phone: phone,
        wechat: wechat,
        address: address,
        records: records
    };
    console.log(customer);
    alert("客户信息已保存！\n"+JSON.stringify(customer,null,4));
    return false;
}
</script>
</body>
</html>