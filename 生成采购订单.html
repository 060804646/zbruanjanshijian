<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>生成采购订单</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    /* 自定义滚动条 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="min-h-screen p-6">
    <!-- 页面标题 -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-800">生成采购订单</h1>
      <p class="text-gray-500 mt-1">创建新的采购订单，记录采购商品明细</p>
    </div>

    <!-- 订单表单 -->
    <div class="bg-white rounded-lg shadow-md p-6 max-w-6xl mx-auto">
      <form id="purchaseOrderForm">
        <!-- 订单基本信息 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">订单编号 <span class="text-red-500">*</span></label>
            <input type="text" id="orderNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="PO-2024-001" readonly>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">订单日期 <span class="text-red-500">*</span></label>
            <input type="date" id="orderDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="2024-06-19">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">供应商 <span class="text-red-500">*</span></label>
            <input id="supplier" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">到货时间 <span class="text-red-500">*</span></label>
            <input type="date" id="deliveryDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>

        <!-- 商品明细 -->
        <div class="mb-6">
          <div class="flex justify-between items-center mb-3">
            <h3 class="font-bold text-gray-800">采购商品明细</h3>
            <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors" onclick="addProductRow()">
              <i class="fa fa-plus mr-1"></i>添加商品
            </button>
          </div>
          
          <div class="overflow-x-auto">
            <table class="min-w-full border-collapse" id="productTable">
              <thead>
                <tr class="bg-gray-100 text-left text-sm font-medium text-gray-700">
                  <th class="px-3 py-2 border">商品名称</th>
                  <th class="px-3 py-2 border">规格型号</th>
                  <th class="px-3 py-2 border">单位</th>
                  <th class="px-3 py-2 border">数量</th>
                  <th class="px-3 py-2 border">单价(元)</th>
                  <th class="px-3 py-2 border">金额(元)</th>
                  <th class="px-3 py-2 border">操作</th>
                </tr>
              </thead>
              <tbody id="productTableBody">
                <tr class="product-row">
                  <td class="px-3 py-2 border">
                    <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="请输入商品名称" required>
                  </td>
                  <td class="px-3 py-2 border">
                    <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="规格型号">
                  </td>
                  <td class="px-3 py-2 border">
                    <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="单位" required>
                  </td>
                  <td class="px-3 py-2 border">
                    <input type="number" min="1" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 quantity" placeholder="数量" required onchange="calculateAmount(this)">
                  </td>
                  <td class="px-3 py-2 border">
                    <input type="number" step="0.01" min="0" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 price" placeholder="单价" required onchange="calculateAmount(this)">
                  </td>
                  <td class="px-3 py-2 border">
                    <input type="number" step="0.01" class="w-full px-2 py-1 border border-gray-300 rounded bg-gray-50 amount" readonly placeholder="0.00">
                  </td>
                  <td class="px-3 py-2 border text-center">
                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removeProductRow(this)">
                      <i class="fa fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="mt-3 flex justify-end">
            <div class="bg-gray-100 px-4 py-2 rounded-md">
              <span class="text-sm font-medium">总计金额：</span>
              <span class="text-lg font-bold text-blue-600" id="totalAmount">¥0.00</span>
            </div>
          </div>
        </div>

        <!-- 备注 -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-1">备注</label>
          <textarea id="remark" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="请输入备注信息"></textarea>
        </div>

        <!-- 按钮组 -->
        <div class="flex justify-end gap-3">
          <button type="button" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="resetForm()">
            重置
          </button>
          <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
            保存订单
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // 添加商品行
    function addProductRow() {
      const tbody = document.getElementById('productTableBody');
      const newRow = document.createElement('tr');
      newRow.className = 'product-row';
      newRow.innerHTML = `
        <td class="px-3 py-2 border">
          <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="请输入商品名称" required>
        </td>
        <td class="px-3 py-2 border">
          <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="规格型号">
        </td>
        <td class="px-3 py-2 border">
          <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="单位" required>
        </td>
        <td class="px-3 py-2 border">
          <input type="number" min="1" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 quantity" placeholder="数量" required onchange="calculateAmount(this)">
        </td>
        <td class="px-3 py-2 border">
          <input type="number" step="0.01" min="0" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 price" placeholder="单价" required onchange="calculateAmount(this)">
        </td>
        <td class="px-3 py-2 border">
          <input type="number" step="0.01" class="w-full px-2 py-1 border border-gray-300 rounded bg-gray-50 amount" readonly placeholder="0.00">
        </td>
        <td class="px-3 py-2 border text-center">
          <button type="button" class="text-red-600 hover:text-red-800" onclick="removeProductRow(this)">
            <i class="fa fa-trash"></i>
          </button>
        </td>
      `;
      tbody.appendChild(newRow);
    }

    // 删除商品行
    function removeProductRow(button) {
      const row = button.closest('tr');
      if (document.querySelectorAll('.product-row').length > 1) {
        row.remove();
        updateTotalAmount();
      } else {
        alert('至少需要保留一条商品记录！');
      }
    }

    // 计算金额
    function calculateAmount(input) {
      const row = input.closest('tr');
      const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
      const price = parseFloat(row.querySelector('.price').value) || 0;
      const amount = quantity * price;
      row.querySelector('.amount').value = amount.toFixed(2);
      updateTotalAmount();
    }

    // 更新总金额
    function updateTotalAmount() {
      const amounts = document.querySelectorAll('.amount');
      let total = 0;
      amounts.forEach(input => {
        total += parseFloat(input.value) || 0;
      });
      document.getElementById('totalAmount').textContent = `¥${total.toFixed(2)}`;
    }

    // 重置表单
    function resetForm() {
      if (confirm('确定要重置表单吗？')) {
        document.getElementById('purchaseOrderForm').reset();
        document.getElementById('orderNumber').value = 'PO-2024-001';
        document.getElementById('orderDate').value = '2024-06-19';
        
        // 重置商品明细
        const tbody = document.getElementById('productTableBody');
        tbody.innerHTML = `
          <tr class="product-row">
            <td class="px-3 py-2 border">
              <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="请输入商品名称" required>
            </td>
            <td class="px-3 py-2 border">
              <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="规格型号">
            </td>
            <td class="px-3 py-2 border">
              <input type="text" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="单位" required>
            </td>
            <td class="px-3 py-2 border">
              <input type="number" min="1" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 quantity" placeholder="数量" required onchange="calculateAmount(this)">
            </td>
            <td class="px-3 py-2 border">
              <input type="number" step="0.01" min="0" class="w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 price" placeholder="单价" required onchange="calculateAmount(this)">
            </td>
            <td class="px-3 py-2 border">
              <input type="number" step="0.01" class="w-full px-2 py-1 border border-gray-300 rounded bg-gray-50 amount" readonly placeholder="0.00">
            </td>
            <td class="px-3 py-2 border text-center">
              <button type="button" class="text-red-600 hover:text-red-800" onclick="removeProductRow(this)">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
        updateTotalAmount();
      }
    }

    // 表单提交
    document.getElementById('purchaseOrderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // 验证必填项
      const requiredFields = ['supplier', 'deliveryDate'];
      let isValid = true;
      
      requiredFields.forEach(field => {
        const element = document.getElementById(field);
        if (!element.value) {
          element.classList.add('border-red-500');
          isValid = false;
        } else {
          element.classList.remove('border-red-500');
        }
      });
      
      // 验证商品明细
      const rows = document.querySelectorAll('.product-row');
      let hasProduct = false;
      rows.forEach(row => {
        const inputs = row.querySelectorAll('input[required]');
        inputs.forEach(input => {
          if (!input.value) {
            input.classList.add('border-red-500');
            isValid = false;
          } else {
            input.classList.remove('border-red-500');
          }
        });
        
        const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        if (quantity > 0 && price > 0) {
          hasProduct = true;
        }
      });
      
      if (!hasProduct) {
        alert('请至少添加一条有效的商品明细！');
        isValid = false;
      }
      
      if (isValid) {
        // 收集表单数据
        const formData = {
          orderNumber: document.getElementById('orderNumber').value,
          orderDate: document.getElementById('orderDate').value,
          supplier: document.getElementById('supplier').value,
          deliveryDate: document.getElementById('deliveryDate').value,
          remark: document.getElementById('remark').value,
          products: [],
          totalAmount: document.getElementById('totalAmount').textContent
        };
        
        rows.forEach(row => {
          const product = {
            name: row.querySelector('input[type="text"]').value,
            model: row.querySelectorAll('input[type="text"]')[1].value,
            unit: row.querySelectorAll('input[type="text"]')[2].value,
            quantity: row.querySelector('.quantity').value,
            price: row.querySelector('.price').value,
            amount: row.querySelector('.amount').value
          };
          formData.products.push(product);
        });
        
        console.log('采购订单数据：', formData);
        alert('采购订单保存成功！\n订单编号：' + formData.orderNumber + '\n总金额：' + formData.totalAmount);
      } else {
        alert('请填写完整的订单信息！');
      }
    });

    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 设置默认到货时间为7天后
      const today = new Date();
      const deliveryDate = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
      const deliveryDateStr = deliveryDate.toISOString().split('T')[0];
      document.getElementById('deliveryDate').value = deliveryDateStr;
    });
  </script>
</body>
</html>