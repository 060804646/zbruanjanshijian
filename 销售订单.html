<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>销售订单</title>
<style>
    body{font-family:"微软雅黑";background:#f5f5f5;margin:0;padding:20px}
    .box{width:800px;margin:0 auto;background:#fff;padding:20px;border:1px solid #ddd}
    h2{margin:0 0 10px;font-size:18px}
    .row{margin-bottom:8px;font-size:14px}
    .row label{display:inline-block;width:80px;text-align:right;margin-right:6px}
    .row input,.row select{padding:5px;border:1px solid #ccc;width:160px}
    table{width:100%;border-collapse:collapse;font-size:14px;margin-top:10px}
    th,td{border:1px solid #ddd;padding:6px;text-align:center}
    th{background:#f0f0f0}
    .btn-add{padding:4px 10px;background:#2c7eda;color:#fff;border:none;cursor:pointer;font-size:12px}
    .btn-save{padding:6px 20px;background:#5cb85c;color:#fff;border:none;cursor:pointer;margin-top:10px}
    .short{width:60px}
    /* 左上角按钮容器 */
    .table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
</style>
</head>
<body>
<div class="box">
    <h2>销售订单</h2>
    <form id="orderForm" onsubmit="return saveOrder()">
        <div class="row">
            <label>订单编号：</label>
            <input type="text" id="orderNo" required>
            <label>日期：</label>
            <input type="date" id="orderDate" required>
        </div>
        <div class="row">
            <label>客户：</label>
            <input type="text" id="customer" required>
            <label>付款方式：</label>
            <select id="payType" required>
                <option value="">请选择</option>
                <option>现金</option>
                <option>微信</option>
                <option>支付宝</option>
                <option>银行卡</option>
            </select>
        </div>

        <!-- 表格左上角按钮 -->
        <div class="table-header">
            <div></div>
            <button type="button" class="btn-add" onclick="addItem()">添加商品</button>
        </div>

        <!-- 商品明细 -->
        <table id="itemTable">
            <thead>
                <tr><th>商品名称</th><th>数量</th><th>单价(元)</th><th>金额(元)</th><th>操作</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="row" style="margin-top:10px;text-align:right">
            <label>合计金额：</label>
            <input type="text" id="totalMoney" readonly style="width:100px">
        </div>

        <button type="submit" class="btn-save">保存订单</button>
    </form>
</div>

<script>
// 初始日期
document.getElementById("orderDate").value = new Date().toISOString().slice(0,10);
document.getElementById("orderNo").value = "SO-" + Date.now().toString().slice(-6);

// 添加商品行
function addItem(){
    var tbody = document.querySelector("#itemTable tbody");
    var row = document.createElement("tr");
    row.innerHTML = 
        '<td><input type="text" name="product" required></td>'+
        '<td><input type="number" min="1" name="qty" class="short" required onchange="calcRow(this)"></td>'+
        '<td><input type="number" step="0.01" min="0" name="price" class="short" required onchange="calcRow(this)"></td>'+
        '<td><input type="number" step="0.01" readonly name="amount" class="short"></td>'+
        '<td><button type="button" class="btn-del" onclick="delRow(this)">删除</button></td>';
    tbody.appendChild(row);
}

// 计算单行金额
function calcRow(inp){
    var row = inp.parentNode.parentNode;
    var qty = parseFloat(row.querySelector("[name=qty]").value)||0;
    var price = parseFloat(row.querySelector("[name=price]").value)||0;
    row.querySelector("[name=amount]").value = (qty*price).toFixed(2);
    total();
}

// 合计
function total(){
    var amts = document.querySelectorAll("[name=amount]");
    var s = 0;
    for(var i=0;i<amts.length;i++) s += parseFloat(amts[i].value)||0;
    document.getElementById("totalMoney").value = s.toFixed(2);
}

// 删除行
function delRow(btn){
    btn.parentNode.parentNode.remove();
    total();
}

// 保存
function saveOrder(){
    var orderNo = document.getElementById("orderNo").value;
    var orderDate = document.getElementById("orderDate").value;
    var customer = document.getElementById("customer").value;
    var payType = document.getElementById("payType").value;
    var totalMoney = document.getElementById("totalMoney").value;

    if(!orderNo||!orderDate||!customer||!payType){alert("请填写完整头信息");return false;}
    var items = document.querySelectorAll("#itemTable tbody tr");
    if(items.length===0){alert("请至少添加一个商品");return false;}

    var detail = [];
    for(var i=0;i<items.length;i++){
        var cells = items[i].querySelectorAll("input");
        if(!cells[0].value||!cells[1].value||!cells[2].value){alert("商品信息必填");return false;}
        detail.push({
            product: cells[0].value,
            qty: cells[1].value,
            price: cells[2].value,
            amount: cells[3].value
        });
    }

    var order = {
        orderNo: orderNo,
        orderDate: orderDate,
        customer: customer,
        payType: payType,
        total: totalMoney,
        items: detail
    };
    console.log(order);
    alert("订单已保存！\n"+JSON.stringify(order,null,4));
    return false;
}
</script>
</body>
</html>